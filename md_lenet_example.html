<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>onnx2versal: Lenet Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">onnx2versal
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_lenet_example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Lenet Example </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md13"></a>
Requirements and setup</h1>
<ul>
<li>See <a href="README.md#Requirements">README Requirements</a></li>
<li>See <a href="README.md#Setup">README Setup</a></li>
<li>Make sure you don't <code>source sample_env_setup.sh</code> as it overwrites your python environment for this section.</li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
Train Lenet model on MNIST</h1>
<div class="fragment"><div class="line">$ cd python/;python train.py</div>
<div class="line">stdout:</div>
<div class="line">accuracy: 0.xxx</div>
<div class="line">Model finished training</div>
<div class="line">Converted to onnx</div>
<div class="line">Exported model has been tested with ONNXRuntime, and the result looks good!</div>
<div class="line"> </div>
<div class="line">files:</div>
<div class="line">models/</div>
<div class="line">├── lenet_mnist.onnx</div>
<div class="line">└── lenet_mnist.pkl</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md15"></a>
Generate files</h1>
<div class="fragment"><div class="line">$ python generate.py</div>
<div class="line"> </div>
<div class="line">stdout:</div>
<div class="line">WARNING: fusing Conv+Relu</div>
<div class="line">Padding Conv weights (6, 1, 5, 5) to (6, 1, 5, 8)</div>
<div class="line">WARNING: fusing Conv+Relu</div>
<div class="line">Padding Conv weights (16, 6, 5, 5) to (16, 6, 5, 8)</div>
<div class="line">WARNING: Shape not implemented, skipping...</div>
<div class="line">WARNING: Constant not implemented, skipping...</div>
<div class="line">WARNING: Gather not implemented, skipping...</div>
<div class="line">WARNING: Constant not implemented, skipping...</div>
<div class="line">WARNING: Unsqueeze not implemented, skipping...</div>
<div class="line">WARNING: Constant not implemented, skipping...</div>
<div class="line">WARNING: Concat not implemented, skipping...</div>
<div class="line">WARNING: Reshape not implemented, skipping...</div>
<div class="line">Found matching output /Reshape_output_0 and k5pool output</div>
<div class="line">Padding Gemm weights (84, 10) to (84, 12)</div>
<div class="line">Generating MNIST txt for 100 data points</div>
<div class="line"> </div>
<div class="line">files:</div>
<div class="line">models/</div>
<div class="line">├── lenet_mnist_inter.onnx</div>
<div class="line">├── lenet_mnist.onnx</div>
<div class="line">└── lenet_mnist.pkl</div>
<div class="line">data/</div>
<div class="line">├── input.txt</div>
<div class="line">├── k0conv_goldenout.txt</div>
<div class="line">├── k0conv_in.txt</div>
<div class="line">├── k14gemm_goldenout.txt</div>
<div class="line">├── k14gemm_in.txt</div>
<div class="line">├── k16gemm_goldenout.txt</div>
<div class="line">├── k16gemm_in.txt</div>
<div class="line">├── k18gemm_goldenout.txt</div>
<div class="line">├── k18gemm_in.txt</div>
<div class="line">├── k2pool_goldenout.txt</div>
<div class="line">├── k2pool_in.txt</div>
<div class="line">├── k3conv_goldenout.txt</div>
<div class="line">├── k3conv_in.txt</div>
<div class="line">├── k5pool_goldenout.txt</div>
<div class="line">├── k5pool_in.txt</div>
<div class="line">├── mnist_test_data.txt</div>
<div class="line">└── mnist_test_label.txt</div>
<div class="line">design/</div>
<div class="line">├── aie_src</div>
<div class="line">│   └── graph_lenet_mnist.cpp</div>
<div class="line">├── host_app_src</div>
<div class="line">│   └── lenet_mnist_aie_app.cpp</div>
<div class="line">├── system_configs</div>
<div class="line">│   ├── lenet_mnist.cfg</div>
<div class="line">│   └── lenet_mnist_output_inter.cfg</div>
<div class="line">└── trafficgen</div>
<div class="line">    ├── xtg_lenet_mnist_output_inter.py</div>
<div class="line">    └── xtg_lenet_mnist.py</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md16"></a>
Make options</h1>
<p>See <a href="README.md#usage---simulation-verification-profiling-hardware-build">README Make Options</a></p>
<h1><a class="anchor" id="autotoc_md17"></a>
Functional check: runs graph in x86simulator</h1>
<p>(~1 min compile, ~0s run)<br  />
 For graph test, ITER_CNT is an argument into graph compilation (make graph) </p><div class="fragment"><div class="line">$ TARGET=sw_emu GRAPH=lenet_mnist make graph clean_reports aiesim</div>
<div class="line"> </div>
<div class="line">stdout:</div>
<div class="line">...</div>
<div class="line">Checking 1/7: k5pool_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 2/7: k0conv_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 3/7: k2pool_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 4/7: k18gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 5/7: k16gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 6/7: k3conv_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 7/7: k14gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line"> </div>
<div class="line">files:</div>
<div class="line">reports_dir/</div>
<div class="line">└── lenet_mnist</div>
<div class="line">    └── sw_emu</div>
<div class="line">        └── x86simulator_output</div>
<div class="line">            ├── k0conv_goldenout.txt</div>
<div class="line">            ├── k14gemm_goldenout.txt</div>
<div class="line">            ├── k16gemm_goldenout.txt</div>
<div class="line">            ├── k18gemm_goldenout.txt</div>
<div class="line">            ├── k2pool_goldenout.txt</div>
<div class="line">            ├── k3conv_goldenout.txt</div>
<div class="line">            ├── k5pool_goldenout.txt</div>
<div class="line">            ├── x86sim.aierun_summary</div>
<div class="line">            ├── x86sim_check.log</div>
<div class="line">            └── x86simulator.log</div>
</div><!-- fragment --><p><b>Traffic generator will have extra stdout and files (EXTIO=1)</b></p>
<div class="fragment"><div class="line">extra stdout:</div>
<div class="line">17:54:35: Creating ipc_axis_master_util for plin0_lenet_mnist_input...</div>
<div class="line">17:54:36: Creating ipc_axis_slave_util for plout0_lenet_mnist_k18gemm...</div>
<div class="line">17:54:36: Creating ipc_axis_slave_util for plout1_lenet_mnist_k0conv...</div>
<div class="line">...</div>
<div class="line">17:54:36: Begin run...</div>
<div class="line">17:54:36: Running master plin0_lenet_mnist_input</div>
<div class="line">17:54:36: [plin0_lenet_mnist_input]: Sending 392 float32 data...</div>
<div class="line">17:54:36: Running slave plout0_lenet_mnist_k18gemm</div>
<div class="line">17:54:36: Running slave plout1_lenet_mnist_k0conv</div>
<div class="line">...</div>
<div class="line">17:54:36: [plout1_lenet_mnist_k0conv]: read lines #0</div>
<div class="line">17:54:36: [plout2_lenet_mnist_k2pool]: read lines #0</div>
<div class="line">...</div>
<div class="line">Written to /home/ruien/workspace/test/reports_dir/lenet_mnist/sw_emu/x86simulator_output/k18gemm_goldenout.txt</div>
<div class="line">17:54:37: Slave plout1_lenet_mnist_k0conv finished. Written to /home/ruien/workspace/test/reports_dir/lenet_mnist/sw_emu/x86simulator_output/k0conv_goldenout.txt</div>
<div class="line">17:54:37: Slave plout2_lenet_mnist_k2pool finished. Written to /home/ruien/workspace/test/</div>
<div class="line">...</div>
<div class="line">17:54:37: Master plin0_lenet_mnist_input finished.</div>
<div class="line">|INFO | plin0_lenet_mnist_input will connect to :: /tmp/unix_ruien:plin0_lenet_mnist_input</div>
<div class="line">|INFO | plout0_lenet_mnist_k18gemm will connect to :: /tmp/unix_ruien:plout0_lenet_mnist_k18gemm</div>
<div class="line">|INFO | plout3_lenet_mnist_k3conv will connect to :: /tmp/unix_ruien:plout3_lenet_mnist_k3conv</div>
<div class="line">|INFO | plout1_lenet_mnist_k0conv will connect to :: /tmp/unix_ruien:plout1_lenet_mnist_k0conv</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">extra files:</div>
<div class="line">reports_dir/</div>
<div class="line">└── lenet_mnist</div>
<div class="line">    └── sw_emu</div>
<div class="line">        └── x86simulator_output</div>
<div class="line">             └── x86sim_filetraffic.log</div>
</div><!-- fragment --><p><b>Analyze graph compilation after compile</b> </p><div class="fragment"><div class="line">vitis_analyzer build/lenet_mnist/sw_emu/Work/graph_lenet_mnist.aiecompile_summary</div>
</div><!-- fragment --><p> <b>Clean software graph build</b> </p><div class="fragment"><div class="line">TARGET=sw_emu GRAPH=lenet_mnist make clean</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md18"></a>
Functional check: runs system software emulation</h1>
<p>(x86 graph, sysC kernels, ~2 min compile)<br  />
 For system test, ITER_CNT is an argument into host app compilation (make application) </p><div class="fragment"><div class="line">$ TARGET=sw_emu GRAPH=lenet_mnist make graph kernels xsa application package</div>
<div class="line">$ TARGET=sw_emu GRAPH=lenet_mnist make clean_reports run_emu</div>
<div class="line"> </div>
<div class="line">stdout:</div>
<div class="line">Initializing ADF API...</div>
<div class="line"> </div>
<div class="line">Config:</div>
<div class="line">xclbin: a.xclbin</div>
<div class="line">iter_cnt: 1</div>
<div class="line">data_dir: /home/ruien/workspace/test/data/</div>
<div class="line">out_dir: /home/ruien/workspace/test/reports_dir/lenet_mnist/sw_emu/x86simulator_output/</div>
<div class="line"> </div>
<div class="line">CRITICAL WARNING: [SW-EM 09-0] Unable to find emconfig.json. Using default device &quot;xilinx:pcie-hw-em:7v3:1.0&quot;</div>
<div class="line">CRITICAL WARNING: [SW-EM 09-0] Unable to find emconfig.json. Using default device &quot;xilinx:pcie-hw-em:7v3:1.0&quot;</div>
<div class="line">Input0 memory virtual addr 0x0x7f1b94000000</div>
<div class="line">Output0 memory virtual addr 0x0x7f1394000000</div>
<div class="line">Inter1 memory virtual addr 0x0x7f0b94000000</div>
<div class="line">Inter2 memory virtual addr 0x0x7f0394000000</div>
<div class="line">...</div>
<div class="line">[init lenet_mnist]: success</div>
<div class="line">[run lenet_mnist]: success</div>
<div class="line">[wait lenet_mnist]: success</div>
<div class="line">Kernel Name: mm2s_0, CU Number: 0, Thread creation status: success</div>
<div class="line">Kernel Name: s2mm_0, CU Number: 1, Thread creation status: success</div>
<div class="line">Kernel Name: s2mm_1, CU Number: 2, Thread creation status: success</div>
<div class="line">...</div>
<div class="line">Kernel Name: mm2s_0, CU Number: 0, State: Start</div>
<div class="line">Kernel Name: mm2s_0, CU Number: 0, State: Running</div>
<div class="line">Kernel Name: s2mm_0, CU Number: 1, State: Start</div>
<div class="line">Kernel Name: s2mm_0, CU Number: 1, State: Running</div>
<div class="line">...</div>
<div class="line">Running Conv5x5on8ReluBCHW&lt;28, 24, 1, 1, 6&gt;</div>
<div class="line">start = -1,end = -1,total = 0</div>
<div class="line">Running Maxpool2x2BCHW::filter&lt;24, 12, 1, 6&gt;</div>
<div class="line">Kernel Name: s2mm_1, CU Number: 2, State: Idle</div>
<div class="line">start = -1,end = -1,total = 0</div>
<div class="line">Running Conv5x5on8ReluBCHW&lt;12, 8, 1, 6, 16&gt;</div>
<div class="line">Kernel Name: s2mm_2, CU Number: 3, State: Idle</div>
<div class="line">start = -1,end = -1,total = 0</div>
<div class="line">Running Maxpool2x2BCHW::filter&lt;8, 4, 1, 16&gt;</div>
<div class="line">Kernel Name: s2mm_3, CU Number: 4, State: Idle</div>
<div class="line">start = -1,end = -1,total = 0</div>
<div class="line">...</div>
<div class="line">device process sw_emu_device done</div>
<div class="line">Kernel Name: mm2s_0, CU Number: 0, Status: Shutdown</div>
<div class="line">Kernel Name: s2mm_0, CU Number: 1, Status: Shutdown</div>
<div class="line">...</div>
<div class="line">INFO [HLS SIM]: The maximum depth reached by any hls::stream() instance in the design is 157</div>
<div class="line">INFO [HLS SIM]: The maximum depth reached by any hls::stream() instance in the design is 573</div>
<div class="line">[end lenet_mnist]: success</div>
<div class="line">Waiting for dma hls to complete...</div>
<div class="line">mm2s completed with status (4)</div>
<div class="line">s2mm completed with status (4)</div>
<div class="line">Closed runtime handlers and kernel handlers...</div>
<div class="line">inter1 completed with status (4)</div>
<div class="line">inter2 completed with status (4)</div>
<div class="line">...</div>
<div class="line">Released I/O buffer objects.</div>
<div class="line">Checking directories /home/ruien/workspace/test/reports_dir/lenet_mnist/sw_emu/x86simulator_output and /home/ruien/workspace/test/data</div>
<div class="line">Checking 1/7: k18gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 2/7: k14gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 3/7: k0conv_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 4/7: k5pool_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 5/7: k2pool_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 6/7: k3conv_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 7/7: k16gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line"> </div>
<div class="line">files:</div>
<div class="line">reports_dir/</div>
<div class="line">└── lenet_mnist</div>
<div class="line">    └── sw_emu</div>
<div class="line">        └── x86simulator_output</div>
<div class="line">            ├── embedded_run.log</div>
<div class="line">            ├── k0conv_goldenout.txt</div>
<div class="line">            ├── k14gemm_goldenout.txt</div>
<div class="line">            ├── k16gemm_goldenout.txt</div>
<div class="line">            ├── k18gemm_goldenout.txt</div>
<div class="line">            ├── k2pool_goldenout.txt</div>
<div class="line">            ├── k3conv_goldenout.txt</div>
<div class="line">            ├── k5pool_goldenout.txt</div>
<div class="line">            └── x86sim_check.log</div>
</div><!-- fragment --><p><b>Analyze system compilation after compile</b> </p><div class="fragment"><div class="line">vitis_analyzer build/lenet_mnist/sw_emu/vck190_lenet_mnist_aie.xsa.link_summary</div>
</div><!-- fragment --><p> <b>Clean build</b> </p><div class="fragment"><div class="line">TARGET=sw_emu GRAPH=lenet_mnist make clean</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
Functional/performance check: runs graph in aiesimulator</h1>
<p>(with SysC ~4.5 min compile, ~8 min run)<br  />
 For graph test, ITER_CNT is an argument into graph compilation (make graph) </p><div class="fragment"><div class="line">$ TARGET=hw_emu GRAPH=lenet_mnist make graph</div>
<div class="line">$ TARGET=hw_emu GRAPH=lenet_mnist make clean_reports aiesim_profile</div>
<div class="line"> </div>
<div class="line">stdout:</div>
<div class="line">Waiting for core(s) of graph lenet_mnist to finish execution ...</div>
<div class="line">Running Conv5x5on8ReluBCHW&lt;28, 24, 1, 1, 6&gt;</div>
<div class="line">start = 3236,end = 20164,total = 16928</div>
<div class="line">Running Maxpool2x2BCHW::filter&lt;24, 12, 1, 6&gt;</div>
<div class="line">start = 24570,end = 25471,total = 901</div>
<div class="line">Running Conv5x5on8ReluBCHW&lt;12, 8, 1, 6, 16&gt;</div>
<div class="line">start = 26651,end = 52727,total = 26076</div>
<div class="line">Running Maxpool2x2BCHW::filter&lt;8, 4, 1, 16&gt;</div>
<div class="line">start = 54101,end = 54392,total = 291</div>
<div class="line">Running GemmReluMKKN&lt;1, 256, 16&gt;</div>
<div class="line">Running GemmReluMKKN&lt;1, 256, 16&gt;</div>
<div class="line">Running GemmReluMKKN&lt;1, 256, 16&gt;</div>
<div class="line">Running GemmReluMKKN&lt;1, 256, 16&gt;</div>
<div class="line">Running GemmReluMKKN&lt;1, 256, 16&gt;</div>
<div class="line">Running GemmReluMKKN&lt;1, 256, 16&gt;</div>
<div class="line">Running GemmReluMKKN&lt;1, 256, 16&gt;</div>
<div class="line">Running GemmReluMKKN&lt;1, 256, 16&gt;</div>
<div class="line">start = 54820,end = 55723,total = 903</div>
<div class="line">start = 54824,end = 55727,total = 903</div>
<div class="line">start = 54824,end = 55727,total = 903</div>
<div class="line">start = 54828,end = 55731,total = 903</div>
<div class="line">start = 54832,end = 55735,total = 903</div>
<div class="line">start = 54836,end = 55739,total = 903</div>
<div class="line">start = 54840,end = 55743,total = 903</div>
<div class="line">start = 54844,end = 55747,total = 903</div>
<div class="line">Running ConcatVector&lt;8, 16, 16, 120&gt;::filter8</div>
<div class="line">start = 55947,end = 56073,total = 126</div>
<div class="line">Running GemmReluMKKN&lt;1, 120, 32&gt;</div>
<div class="line">Running GemmReluMKKN&lt;1, 120, 32&gt;</div>
<div class="line">Running GemmReluMKKN&lt;1, 120, 32&gt;</div>
<div class="line">start = 56393,end = 57281,total = 888</div>
<div class="line">start = 56397,end = 57285,total = 888</div>
<div class="line">start = 56401,end = 57289,total = 888</div>
<div class="line">Running ConcatVector&lt;3, 32, 32, 84&gt;::filter3</div>
<div class="line">start = 57437,end = 57510,total = 73</div>
<div class="line">Running GemmReluMKKN&lt;1, 84, 48&gt;</div>
<div class="line">start = 57782,end = 58755,total = 973</div>
<div class="line">Running ConcatScalar&lt;1, 48, 48, 10&gt;::filter1</div>
<div class="line">start = 58899,end = 59777,total = 878</div>
<div class="line">core(s) are done executing</div>
<div class="line">[wait graph]: success</div>
<div class="line">plout[0]: Cycles 10 Throughput 1000000000.000000 samples/s</div>
<div class="line">Waiting for core(s) of graph lenet_mnist to finish execution ...</div>
<div class="line">core(s) are done executing</div>
<div class="line">[end lenet_mnist]: success</div>
<div class="line">Exiting!</div>
<div class="line">generate profile data for all cores</div>
<div class="line">generate profile data for all cores</div>
<div class="line">Stopping Simulator.</div>
<div class="line">Info: /OSCI/SystemC: Simulation stopped by user.</div>
<div class="line">...</div>
<div class="line">[INFO] : Simulation Finished, Sim result: 0</div>
<div class="line">Checking directories /home/ruien/workspace/test/reports_dir/lenet_mnist/hw_emu/aiesimulator_output and /home/ruien/workspace/test/data</div>
<div class="line">Checking 1/7: k14gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 2/7: k16gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 3/7: k18gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 4/7: k3conv_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 5/7: k0conv_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 6/7: k5pool_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 7/7: k2pool_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line"> </div>
<div class="line">files:</div>
<div class="line">reports_dir/</div>
<div class="line">└── lenet_mnist</div>
<div class="line">    └── hw_emu</div>
<div class="line">        └── aiesimulator_output</div>
<div class="line">            ├── aiesim.log</div>
<div class="line">            ├── aiesim_options.txt</div>
<div class="line">            ├── default.aierun_summary</div>
<div class="line">            ├── k0conv_goldenout.txt</div>
<div class="line">            ├── k14gemm_goldenout.txt</div>
<div class="line">            ├── k16gemm_goldenout.txt</div>
<div class="line">            ├── k18gemm_goldenout.txt</div>
<div class="line">            ├── k2pool_goldenout.txt</div>
<div class="line">            ├── k3conv_goldenout.txt</div>
<div class="line">            ├── k5pool_goldenout.txt</div>
<div class="line">            ├── memconfig.json</div>
<div class="line">            ├── profile_funct_22_0.txt</div>
<div class="line">            ├── profile_funct_22_0.xml</div>
<div class="line">            ├── ...</div>
<div class="line">            ├── region_0x0_0x7fffffff.mmap.dat</div>
<div class="line">            └── aiesim_check.log</div>
</div><!-- fragment --><p><b>Traffic generator will have extra stdout and files (EXTIO=1)</b></p>
<div class="fragment"><div class="line">extra stdout:</div>
<div class="line">INFO::[ XTLM_IPC_AXIS_MASTER ] SIM-IPC&#39;s external process can be connected to instance :  plin0_lenet_mnist_input</div>
<div class="line">INFO::[ XTLM_IPC_AXIS_SLAVE ] SIM-IPC&#39;s external process can be connected to instance :  plout0_lenet_mnist_k18gemm</div>
<div class="line">INFO::[ XTLM_IPC_AXIS_SLAVE ] SIM-IPC&#39;s external process can be connected to instance :  plout1_lenet_mnist_k0conv</div>
<div class="line">[INFO]: Enabled Stream Switch Port Latency </div>
<div class="line">18:45:08: Creating ipc_axis_master_util for plin0_lenet_mnist_input...</div>
<div class="line">18:45:08: Creating ipc_axis_slave_util for plout0_lenet_mnist_k18gemm...</div>
<div class="line">IP-INFO: [ps_i27_ps_main] IP started.</div>
<div class="line">18:45:09: Creating ipc_axis_slave_util for plout1_lenet_mnist_k0conv...</div>
<div class="line">18:45:09: Creating ipc_axis_slave_util for plout2_lenet_mnist_k2pool...</div>
<div class="line">...</div>
<div class="line">18:45:09: Begin run...</div>
<div class="line">18:45:09: Running master plin0_lenet_mnist_input</div>
<div class="line">18:45:09: [plin0_lenet_mnist_input]: Sending 392 float32 data...</div>
<div class="line">18:45:09: Running slave plout0_lenet_mnist_k18gemm</div>
<div class="line">18:45:09: Running slave plout1_lenet_mnist_k0conv</div>
<div class="line">...</div>
<div class="line">18:47:35: [plout1_lenet_mnist_k0conv]: read lines #0</div>
<div class="line">18:47:46: [plout2_lenet_mnist_k2pool]: read lines #0</div>
<div class="line">...</div>
<div class="line">18:51:01: Slave plout0_lenet_mnist_k18gemm finished. Written to /home/ruien/workspace/test/reports_dir/lenet_mnist/hw_emu/aiesimulator_output/k18gemm_goldenout.txt</div>
<div class="line">18:51:01: Slave plout1_lenet_mnist_k0conv finished. Written to /home/ruien/workspace/test/reports_dir/lenet_mnist/hw_emu/aiesimulator_output/k0conv_goldenout.txt</div>
<div class="line">18:51:01: Slave plout2_lenet_mnist_k2pool finished. Written to /home/ruien/workspace/test/reports_dir/lenet_mnist/hw_emu/aiesimulator_output/k2pool_goldenout.txt</div>
<div class="line">...</div>
<div class="line">18:51:01: Master plin0_lenet_mnist_input finished.</div>
<div class="line">WARNING::[ XTLM_IPC::006 ] plin0_lenet_mnist_input Closing Socket</div>
<div class="line">WARNING::[ XTLM_IPC::006 ] plout5_lenet_mnist_k14gemm Closing Socket</div>
<div class="line">WARNING::[ XTLM_IPC::006 ] plout6_lenet_mnist_k16gemm Closing Socket</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">extra files:</div>
<div class="line">reports_dir/</div>
<div class="line">└── lenet_mnist</div>
<div class="line">    └── hw_emu</div>
<div class="line">        └── aiesimulator_output</div>
<div class="line">            └── aiesim_filetraffic.log</div>
</div><!-- fragment --><p><b>Analyze graph compilation after compile</b> </p><div class="fragment"><div class="line">vitis_analyzer build/lenet_mnist/hw_emu/Work/graph_lenet_mnist.aiecompile_summary</div>
</div><!-- fragment --><p> <b>Analyze profiled information after run (includes graph analysis)</b> </p><div class="fragment"><div class="line">vitis_analyzer reports_dir/lenet_mnist/hw_emu/aiesimulator_output/default.aierun_summary</div>
</div><!-- fragment --><p> <b>Clean hardware emulation build</b> </p><div class="fragment"><div class="line">TARGET=hw_emu GRAPH=lenet_mnist make clean</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md20"></a>
Functional/performance check: runs system in hardware emulation with QEMU</h1>
<p>(sysC graph, kernels NoC, DDR, ~15min compile, ~30min run)<br  />
 For system test, ITER_CNT is an argument into host app compilation (make application) </p><div class="fragment"><div class="line">$ TARGET=hw_emu GRAPH=lenet_mnist make graph kernels xsa application package</div>
<div class="line">$ TARGET=hw_emu GRAPH=lenet_mnist make graph clean_reports run_emu</div>
<div class="line"> </div>
<div class="line">stdout:</div>
<div class="line">Initializing ADF API...</div>
<div class="line"> </div>
<div class="line">Config:</div>
<div class="line">xclbin: a.xclbin</div>
<div class="line">iter_cnt: 1</div>
<div class="line">data_dir: data/</div>
<div class="line">out_dir: output/</div>
<div class="line"> </div>
<div class="line">[   79.139175] zocl-drm axi:zyxclmm_drm: zocl_create_client: created KDS client for pid(576), ret: 0</div>
<div class="line">[   79.142194] zocl-drm axi:zyxclmm_drm: zocl_destroy_client: client exits pid(576)</div>
<div class="line">[   79.155865] zocl-drm axi:zyxclmm_drm: zocl_create_client: created KDS client for pid(576), ret: 0</div>
<div class="line">...</div>
<div class="line">[   81.095991] [drm] found kind 29(AIE_RESOURCES)</div>
<div class="line">[   81.096374] [drm] found kind 8(IP_LAYOUT)</div>
<div class="line">[   81.096586] [drm] skip kind 9(DEBUG_IP_LAYOUT) return code: -22</div>
<div class="line">[   81.096772] [drm] found kind 25(AIE_METADATA)</div>
<div class="line">[   81.097048] [drm] found kind 7(CONNECTIVITY)</div>
<div class="line">[   81.097227] [drm] found kind 6(MEM_TOPOLOGY)</div>
<div class="line">[   81.098613] [drm] Memory 0 is not reserved in device tree. Will allocate memory from CMA</div>
<div class="line">[   83.707507] zocl_irq_intc ZOCL_CU_INTC.2.auto: zocl_irq_intc_add: managing IRQ 46</div>
<div class="line">[   83.829517] cu_drv CU.3.auto: cu_probe: CU[0] created</div>
<div class="line">[   84.699804] zocl_irq_intc ZOCL_CU_INTC.2.auto: zocl_irq_intc_add: managing IRQ 47</div>
<div class="line">[   84.790210] cu_drv CU.4.auto: cu_probe: CU[1] created</div>
<div class="line">...</div>
<div class="line">[   91.621456] cu_drv CU.3.auto:  ffff000007cd7c10 xrt_cu_intr_thread: CU[0] start</div>
<div class="line">[   92.042016] cu_drv CU.4.auto:  ffff000007c6a410 xrt_cu_intr_thread: CU[1] start</div>
<div class="line">...</div>
<div class="line">XAIEFAL: INFO: Resource group Avail is created.</div>
<div class="line">XAIEFAL: INFO: Resource group Static is created.</div>
<div class="line">XAIEFAL: INFO: Resource group Generic is created.</div>
<div class="line">[   94.206063] [drm] zocl_xclbin_read_axlf 9fee7350-25b2-b56d-7e20-d9e9d2b8c46f ret: 0</div>
<div class="line">[   94.748985] [drm] bitstream 9fee7350-25b2-b56d-7e20-d9e9d2b8c46f locked, ref=1</div>
<div class="line">[   94.754304] zocl-drm axi:zyxclmm_drm:  ffff000001b9dc10 kds_add_context: Client pid(576) add context Domain(65535) CU(0xffff) shared(true)</div>
<div class="line">[   94.756977] zocl-drm axi:zyxclmm_drm:  ffff000001b9dc10 kds_del_context: Client pid(576) del context Domain(65535) CU(0xffff)</div>
<div class="line">Input0 memory virtual addr 0x0xffffb714e000</div>
<div class="line">[   94.769813] [drm] bitstream 9fee7350-25b2-b56d-7e20-d9e9d2b8c46f unlocked, ref=0</div>
<div class="line">[   94.875906] [drm] bitstream 9fee7350-25b2-b56d-7e20-d9e9d2b8c46f locked, ref=1</div>
<div class="line">[   94.876340] zocl-drm axi:zyxclmm_drm:  ffff000001b9dc10 kds_add_context: Client pid(576) add context Domain(0) CU(0x1) shared(true)</div>
<div class="line">Output0 memory virtual addr 0x0xffffb714c000</div>
<div class="line">[   95.539467] zocl-drm axi:zyxclmm_drm:  ffff000001b9dc10 kds_add_context: Client pid(576) add context Domain(0) CU(0x0) shared(true)</div>
<div class="line">...</div>
<div class="line">[init lenet_mnist]: success</div>
<div class="line">XRT build version: 2.14.0</div>
<div class="line">Build hash: 43926231f7183688add2dccfd391b36a1f000bea</div>
<div class="line">Build date: 2022-10-07 05:12:02</div>
<div class="line">Git branch: 2022.2</div>
<div class="line">PID: 576</div>
<div class="line">UID: 0</div>
<div class="line">[Wed May 17 02:48:04 2023 GMT]</div>
<div class="line">HOST: </div>
<div class="line">EXE: /mnt/aie_xrt.elf</div>
<div class="line">[XRT] ERROR: Can&#39;t start profiling: port name &#39;plout0_lenet_mnist_k18gemm&#39; not found: Invalid argument</div>
<div class="line">[  124.882853] hrtimer: interrupt took 343510625 ns</div>
<div class="line">[run graph]: success</div>
<div class="line">[wait graph]: success</div>
<div class="line">plout[0]: ERROR: Invalid handle. Only two performance counter in a AIE-PL interface tile. Event profile is not supported for x86sim.</div>
<div class="line">[end lenet_mnist]: success</div>
<div class="line">Waiting for dma hls to complete...</div>
<div class="line">mm2s completed with status (4)</div>
<div class="line">[  641.684981] zocl-drm axi:zyxclmm_drm:  ffff000001b9dc10 kds_del_context: Client pid(576) del context Domain(0) CU(0x1)</div>
<div class="line">s2mm completed with status (4)</div>
<div class="line">[  643.379135] zocl-drm axi:zyxclmm_drm:  ffff000001b9dc10 kds_del_context: Client pid(576) del context Domain(0) CU(0x0)</div>
<div class="line">Closed runtime handlers and kernel handlers...</div>
<div class="line">inter1 completed with status (4)</div>
<div class="line">[  643.396986] zocl-drm axi:zyxclmm_drm:  ffff000001b9dc10 kds_del_context: Client pid(576) del context Domain(0) CU(0x2)</div>
<div class="line">inter2 completed with status (4)</div>
<div class="line">[  643.397625] zocl-drm axi:zyxclmm_drm:  ffff000001b9dc10 kds_del_context: Client pid(576) del context Domain(0) CU(0x3)</div>
<div class="line">...</div>
<div class="line">Released I/O buffer objects.</div>
<div class="line">[  643.401090] [drm] bitstream 9fee7350-25b2-b56d-7e20-d9e9d2b8c46f unlocked, ref=0</div>
<div class="line">[  643.535997] zocl-drm axi:zyxclmm_drm: zocl_destroy_client: client exits pid(576)</div>
<div class="line">[  643.555318] zocl-drm axi:zyxclmm_drm: zocl_destroy_client: client exits pid(576)</div>
<div class="line">Checking directories data and output</div>
<div class="line">Checking 1/7: k14gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 2/7: k16gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 3/7: k5pool_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 4/7: k2pool_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 5/7: k3conv_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 6/7: k0conv_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">Checking 7/7: k18gemm_goldenout.txt</div>
<div class="line">TEST (tolerance): OK! (rtol=1e-03, atol=1e-05)</div>
<div class="line">INFO: TEST PASSED, RC=0</div>
<div class="line"> </div>
<div class="line">9 minutes and 36 seconds elapsed.</div>
<div class="line"> </div>
<div class="line">INFO: Embedded host run completed.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">files: (in QEMU environment)</div>
<div class="line">output/</div>
<div class="line">└── lenet_mnist</div>
<div class="line">    ├── k0conv_goldenout.txt</div>
<div class="line">    ├── k14gemm_goldenout.txt</div>
<div class="line">    ├── k16gemm_goldenout.txt</div>
<div class="line">    ├── k18gemm_goldenout.txt</div>
<div class="line">    ├── k2pool_goldenout.txt</div>
<div class="line">    ├── k3conv_goldenout.txt</div>
<div class="line">    └── k5pool_goldenout.txt</div>
</div><!-- fragment --><p><b>Analyze system compilation after compile</b> </p><div class="fragment"><div class="line">vitis_analyzer build/lenet_mnist/hw_emu/vck190_lenet_mnist_aie.xsa.link_summary</div>
</div><!-- fragment --><p> <b>Clean hardware emulation build</b> </p><div class="fragment"><div class="line">TARGET=hw_emu GRAPH=lenet_mnist make clean</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md21"></a>
Test system on hardware</h1>
<p>(~1h compile, ~6min flash, ~10s boot, ~0s run)<br  />
 <b>Hardware: create hardware image, flash the SD card</b> </p><div class="fragment"><div class="line">$ TARGET=hw GRAPH=lenet_mnist make graph kernels xsa application package</div>
<div class="line">$ sudo dd if=build/lenet_mnist/hw/package/sd_card.img of=/dev/(DEVICE) conv=fsync status=progress</div>
<div class="line"> </div>
<div class="line">stdout:</div>
<div class="line"> </div>
<div class="line">files:</div>
<div class="line">outputs/</div>
<div class="line">└── mnist_test_label.txt</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
